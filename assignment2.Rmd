---
title: "Assignment2"
author: "Oszkar Egervari"
date: '2022-04-07'
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(ggplot2)
library(fixest)
library(WDI)

```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r getting data & cleaning, echo=F}
#gdp
#keeping only countries and  removing country codes
gdp <- WDI(
  start = 1992,
  end = 2018
) %>% tail( -1323) %>% select(-1)

#transforming df to wide for easier filtering of any countries, which have NAs in any year
wide_gdp <- gdp %>% pivot_wider(
  names_from = year, 
  values_from = NY.GDP.PCAP.KD) %>% drop_na()

#transforming back to long format
gdp <- wide_gdp %>% pivot_longer(
  !country, 
  names_to = "year",
  values_to = c("NY.GDP.PCAP.KD")
)
#co2
co2 <- WDI(
  start = 1992,
  end = 2018,
  indicator = "EN.ATM.CO2E.PC"
) %>% tail( -1323) %>% select(-1) %>% 
  # transforming tons to kg
  mutate(
      EN.ATM.CO2E.PC = EN.ATM.CO2E.PC * 1000
  )

wide_co2 <- co2 %>% pivot_wider(
  names_from = year, 
  values_from = EN.ATM.CO2E.PC) %>% drop_na()

co2 <- wide_co2 %>% pivot_longer(
  !country, 
  names_to = "year",
  values_to = c("EN.ATM.CO2E.PC")
)

#joining co2 and gdp tables
data <- inner_join(
  x = gdp,
  y = co2,
)
```

## Models

The first model is a cross-section OLS for year 2018. 

```{r model 1, echo=FALSE}

model1 <- feols( EN.ATM.CO2E.PC ~ NY.GDP.PCAP.KD , data = data %>% filter(year == 2018) )
model1
```

The intercept is `r round(model1$coefficients[1],2)`. That means that if a country has a gdp per capita of 0, its expected CO2 emission per year is `r round(model1$coefficients[1],2)` kg. The beta is `r round(model1$coefficients[2],2)`, which means that if the GDP per capita increases by 1 USD, the country's CO2 emission is expected to increase with `r round(model1$coefficients[2],2)` kg.


```{r}
ggplot(data = data %>% filter(year == 2018), aes(NY.GDP.PCAP.KD, EN.ATM.CO2E.PC)) +
  geom_point() +
  geom_smooth(method='lm')
```





